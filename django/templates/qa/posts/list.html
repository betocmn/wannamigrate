{% extends "_layouts/main.html" %}
{% load staticfiles %}
{% load i18n %}
{% load string_extras %}

{% block content %}
    <div class="content social">
        {% include "qa/common/side_menu.html" %}
        <section class="content">
            <div class="question-postList">
                {% if blogposts_menu_selected %}
                    <!--a class="button bt-addQuestion">Write a post</a-->
                {% elif knowledge_menu_selected or questions_menu_selected %}
                    <a href="{% url "qa:add_question" %}" class="button bt-addQuestion">Add Question</a>
                {% endif %}
                <div class="conten-postList">
                    {% for post in posts %}

                        <div class="question">
                            <div class="tags">
                                <ul class="tags-list">
                                    {% for topic in post.related_topics.all %}
                                        <li class="tag"><a href="{% url "qa:browse_topic" topic_id=topic.id %}" class="tag-link active">{{ topic.name }}</a></li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="data-question">
                                <a href="{% url "qa:view_post" post.id %}">
                                    <h3 class="title-question">{{ post.title }}</h3>
                                    {% if post.post_type.id == POST_TYPE_QUESTION_ID %}
                                        <p class="answer">{{ post.answers.first.body|striptags|truncate_smart:250 }}</p>
                                    {% elif post.post_type.id == POST_TYPE_BLOGPOST_ID %}
                                        <p class="answer">{{ post.body|striptags|truncate_smart:250 }}</p>
                                    {% endif %}
                                </a>
                            </div>
                            <div class="data">
                                <ul class="data-list list-viewers">
                                    <li class="data-item">
                                        {% if post.is_followed %}
                                            <a href="{% url "qa:ajax_unfollow_post" post.id %}" data-toggle-url="{% url "qa:ajax_follow_post" post.id %}" data-toggle-name="{% trans "Follow" %}" data-name="{% trans "UnFollow" %}" class="data-link bt-follow x-link">
                                                {% trans "Unfollow" %}
                                                <span class="count">{{ post.followers_count }}</span>
                                            </a>
                                        {% else %}
                                            <a href="{% url "qa:ajax_follow_post" post.id %}" data-toggle-url="{% url "qa:ajax_unfollow_post" post.id %}" data-toggle-name="{% trans "Unfollow" %}" data-name="{% trans "Follow" %}" class="data-link bt-follow x-link">
                                                {% trans "Follow" %}
                                                <span class="count">{{ post.followers_count }}</span>
                                            </a>
                                        {% endif %}
                                    </li>
                                    <li class="data-item"><span class="data-link answers"><strong>{{ post.answers_count }}</strong> {% trans "answers" %}</span></li>
                                    <li class="data-item"><span class="data-link viewers"><strong>{{ post.views_count }}</strong> {% trans "viewers" %}</span></li>
                                    <li class="data-item">{% trans "Last activity in" %} <strong>{{ post.last_activity_date|date:"b d" }}</strong></li>
                                </ul>
                            </div>
                            <div class="box-options">
                                <i class="shadow"></i>
                                <ul class="box">
                                    <li><a class="bt-share" href="#">{% trans "Share" %}</a></li>
                                    <li><a class="bt-report" href="#">{% trans "Report" %}</a></li>
                                    <li><a class="bt-cancel" href="#">{% trans "Cancel" %}</a></li>
                                </ul>
                            </div>
                            <a href="#" class="bt-options">{% trans "Options" %}</a>
                        </div>
                    {% endfor %}
                    <!--div class="answers">
                        <form class="form-comment">
                            <div class="user">
                                <i class="thumb">
                                    <img src="img/thumb-account.png" alt="">
                                </i>
                            </div>
                            <input type="text" class="text-coments" placeholder="Add a comment"></input>
                            <input type="submit" class="button bt-comment" value="Comment">
                        </form>
                        <div class="answer">
                            <i class="thumb">
                                <img src="img/thumb-account.png" alt="">
                            </i>
                            <div class="post">
                                <div class="user">
                                    <span class="name">Humberto Martins</span>
                                    <span class="info">Designer at humbertolandia.com</span>
                                </div>

                                <span class="text-post">
                                    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                                    tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                                    quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                                    consequat.
                                </span>
                            </div>
                        </div>
                        <div class="answer active">
                            <i class="thumb">
                                <img src="img/thumb-account.png" alt="">
                            </i>
                            <div class="post">
                                <div class="user">
                                    <span class="name">Humberto Martins</span>
                                    <span class="info">Designer at humbertolandia.com</span>
                                </div>

                                <span class="text-post">
                                    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
                                    tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
                                    quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
                                    consequat.
                                </span>
                            </div>
                        </div>
                    </div-->
                </div>
            </div>
        </section>
    </div>

{% endblock content %}


{% block scripts %}

    {{ block.super }}

    <!-- JS REQUIRED BY THIS PAGE -->
    <script type="text/javascript" src="{% static 'common/trunk8/js/trunk8.js' %}"></script>

    <!-- INLINE JS -->
    <script type="text/javascript">
        $( document ).ready( function() {

            $( ".x-link" ).click(function( e ){

                var elm = $(this);
                var current_url = elm.attr( "href" );
                var current_name = elm.attr( "data-name" );
                var toggle_url = elm.attr( "data-toggle-url" );
                var toggle_name = elm.attr( "data-toggle-name" );

                $.get( current_url, { "_": $.now() }, function( data ){
                    // Sets the element's content
                    elm.html( "" ).append( toggle_name ).append( " " ).append(
                        $( "<span/>" ).attr( "class", "count" ).text( data )
                    );

                    // Sets the element's name.
                    elm.attr( "data-name", toggle_name );
                    // Sets the element href.
                    elm.attr( "href", toggle_url );

                    // Sets the toggle attributes
                    elm.attr( "data-toggle-url", current_url );
                    elm.attr( "data-toggle-name", current_name );


                }).fail(function(httpObj, text){
                    if ( httpObj.status == 401 )
                        window.location.href = "{% url "site:login" %}";
                });

                e.preventDefault();
            });
        });
    </script>

    {% include "_layouts/analytics.html" %}

{% endblock scripts %}