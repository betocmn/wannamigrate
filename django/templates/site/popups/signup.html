{% load template_utilities %}
<!-- Facebook Login SDK -->
<script>
  
  /** Starts the login with facebook action. */
  function fb_login() {
      FB.login(statusChangeCallback);
  }
   
  /** Callback function that is called when the facebook's api returns.
  This method handles the login response and threat its results.
  @param response The response object from facebook's api. */
  function statusChangeCallback(response) {
      console.log(response);
      // The response object is returned with a status field that lets the
      // app know the current login status of the person.
      // Full docs on the response object can be found in the documentation
      // for FB.getLoginStatus().
      if (response.status === 'connected') {
          // Logged into your app and Facebook. Redirect...
          alert("logged with facebook");
          //window.location = "{{ login_redirect }}";
      } else if (response.status === 'not_authorized') {
          // The person is logged into Facebook, but not your app.

      } else {
          // The person is not logged into Facebook, so we're not sure if
          // they are logged into this app or not.

      }
  }

  // Initializes the facebook api
  window.fbAsyncInit = function() {
      FB.init({
          appId: '{% get_constant_value "FACEBOOK_APP_ID" %}',
          cookie: true, // enable cookies to allow the server to access 
          // the session
          xfbml: true, // parse social plugins on this page
          version: 'v2.1' // use version 2.1
      });
  };

   // Load the SDK asynchronously
  (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s);
      js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js";
      fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>
<!-- ./Facebook Login SDK -->


<!-- LinkedIn Login SDK Hosted -->
<script type="text/javascript" src="https://platform.linkedin.com/in.js">
  api_key: {% get_constant_value "LINKEDIN_APP_ID" %}
  onLoad: onLinkedInLoad
  authorize: false
</script>
<!-- ./LinkedIn Login SDK Hosted -->

<!-- LinkedIn Login SDK Custom -->
<script type="text/javascript">

  /** Replaces the linkedIn default button. This functions is a workaround. */
  function replace_linkedin_button() {
    var linkedin_login_img_src = "http://thumb.mais.uol.com.br/14306616-small.jpg"
    var bt_linkedin_login_img = $("<img/>").addClass("linkedin_login_button").attr("src", linkedin_login_img_src);
    // Changes the LinkedIn button to a custom image
    $('a[id*=li_ui_li_gen_]').html(bt_linkedin_login_img);
  }

  /** Initialize things when the linkedin api is ready, such as replace of linkedin button and register a callback to handle when the user log in. */
  function onLinkedInLoad() {
      replace_linkedin_button();
      IN.Event.on(IN, "auth", onLinkedInAuth);
  }

  /** Callback function. Handles the user information provided by the linkedin app. */
  function onLinkedInAuth() {
      IN.API.Profile("me").result(displayProfiles);
  }

  // example function threating the data provided by the linkedin.
  function displayProfiles(profiles) {
      member = profiles.values[0];
      alert("<p id=\"" + member.id + "\">Hello " + member.firstName + " " + member.lastName + "</p>");;
  }
</script>
<!-- ./LinkedIn Login SDK Custom -->


<div id="login_modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <img src="https://d1qb2nb5cznatu.cloudfront.net/startups/i/218944-872e78045bad898911a3e4a97724c658-medium_jpg.jpg" />
        </div>
        <div class="modal-body">

            <!-- Facebook Login Button -->
            <a href="javascript:fb_login();"><img src="https://pbs.twimg.com/profile_images/503940439909494784/0z4644EY_normal.png"></a>

            <!-- LinkedIn Login Button -->
            <script type="IN/Login"></script>

            <strong class="line-thru">ou</strong>

            <form id="login_form_email" method="post" role="form" action="">
              <div class="hidden ajax_spinner"></div>
              <fieldset>
                <ul>
                  <li>
                    <label for="login_username">E-mail:</label>
                    <input placeholder="E-mail" type="text" id="login_input_email" name="email" />
                  </li>
                  <li>
                    <label for="login_password">Senha:</label>
                    <input placeholder="Senha" type="password" id="login_input_password" name="password">
                  </li>
                </ul>
              </fieldset>
              <button id="login_button_submit" type="submit" class="btn btn-success">Entrar</button>
            </form>

            <a id="login_link_reset_password" href="{% url 'site:contact' %}">Esqueceu sua senha?</a>

            <p class="primary">
              Não tem uma conta? <a id="login_link_signup" href="#" class="js-link" data-section="signup-select">Inscrever-se</a>
            </p>

        </div>
        <div class="modal-footer">
            Ao clicar nos botões do facebook ou do linkedin e não for usuário do Wanna Migrate, você será cadastrado e estará aceitando os <a href="#">Termos e condições</a> e a <a href="#">Política de privacidade</a> do Wanna Migrate.
        </div>
    </div>
  </div>
</div>