{% load staticfiles %}
{% load i18n %}

<!-- Custom js -->
<script type="text/javascript">

    /**
     * Displays the LOGIN form
     *
     */
    function switch_to_login(){
        $( ".password_recovery_item" ).hide();
        $( ".signup_item" ).hide();
        $( ".login_item" ).fadeIn();
        $( "#global_alert" ).hide();
    }

    /**
     * Displays the SIGNUP form
     *
     */
    function switch_to_signup(){
        $( ".login_item" ).hide();
        $( ".signup_item" ).fadeIn();
        $( "#global_alert" ).hide();
    }

    /**
     * Displays the RECOVER PASSWORD form
     *
     */
    function switch_to_password_recovery(){
        $( ".login_item" ).hide();
        $( ".password_recovery_item" ).fadeIn();
        $( "#global_alert" ).hide();
    }

    /**
     * Jquery On Load
     *
     */
    $( document ).ready( function(){

        // Defaults to login screen
        switch_to_login();

        // Attach a submit handler to the Login Form
        $( ".ajax-submit" ).submit( function( event ) {

            // Stop form from submitting normally
            event.preventDefault();

            // JS FORM Validation (for required fields)
            if ( this.id == 'login_form_email' ){
                var required_fields = 'login_email,login_password';
            } else if ( this.id == 'signup_form_email' ){
                var required_fields = 'signup_email,signup_email_confirmation,signup_password';
            } else {
                var required_fields = 'recovery_email';
            }
            if ( !validate_empty_fields( this, required_fields ) ) {
              return false;
            }

            // Get some values from elements on the page:
            var $form = $( this );
            var url = $form.attr( "action" );
            //var csrftoken = getCookie('csrftoken');
            var csrftoken = document.getElementsByName( 'csrfmiddlewaretoken' )[0].value;

            $.ajax({
            type: "POST",
            url: url,  // or just url: "/my-url/path/"
            data: {
                csrfmiddlewaretoken: csrftoken,
                email: $form.find( "input[name='email']" ).val(),
                email_confirmation: $form.find( "input[name='email_confirmation']" ).val(),
                password: $form.find( "input[name='password']" ).val()
            },
            success: function( result ) {
                if ( result == "OK" ){
                    window.location = "{% url 'site:dashboard' %}";
                } else if ( result == 'EMAIL_SENT' ){
                    switch_to_login();
                    display_success_message( '{% trans "We have successfully sent you an email with a link to reset your password." %}' );
                } else {
                    display_error_message( result, true );
                }

            }
            //error: function(xhr, textStatus, errorThrown) {
               // alert("Please report this error: "+errorThrown+xhr.status+xhr.responseText);
            //}
            });

        });

    });

</script>

<!-- HEADER --> 
<div class="modal-header f14 bold purple regular text-center"> Sign Up </div>
<!-- ./HEADER -->

<!-- BODY -->
<div class="modal-body">
  <div id="result"></div>
  {% include "site/layouts/status.html" %}

    <!-- LOGIN -->
    <form id="login_form_email" class="login_item ajax-submit" method="post" role="form" action="{% url 'site:login' %}">
      {% csrf_token %}
      <div class="hidden ajax_spinner"></div>

      <div class="table-container">
        <div class="row">
          <div class="full">{{ login_form.email }}</div>
        </div>
        <div class="row">
          <div class="half">{{ login_form.password }}</div>
          <div class="half">
            <button id="login_button_submit" type="submit" class="btn btn-success">{% trans "Login" %}</button>
          </div>
        </div>
        <div class="row">
          <div class="half">
            <a id="login_link_reset_password" class="login_item f6 green" href="javascript:switch_to_password_recovery();">
            {% trans "Forgot your password?" %}
            </a>
          </div>
        </div>
      </div>
    </form>
    <!-- ./LOGIN -->

    <!-- SIGNUP -->
    <form id="signup_form_email" class="signup_item ajax-submit" method="post" role="form" action="{% url 'site:signup' %}">
        <div class="hidden ajax_spinner"></div>
        <fieldset>
          <ul>
            <li>
              <label class="" for="{{ signup_form.email.id_for_label }}">{{ signup_form.email.label }}</label>
              {{ signup_form.email }}
            </li>
            <li>
              <label class="" for="{{ signup_form.email_confirmation.id_for_label }}">{{ signup_form.email_confirmation.label }}</label>
              {{ signup_form.email_confirmation }}
            </li>
            <li>
              <label class="" for="{{ signup_form.password.id_for_label }}">{{ signup_form.password.label }}</label>
              {{ signup_form.password }}
            </li>
          </ul>
        </fieldset>
        <button id="signup_button_submit" type="submit" class="btn btn-success">{% trans "Sign-Up" %}</button>
      </form>
      <p class="primary signup_item">
        {% trans "Already registered?" %}
        <a id="login_link_signup" href="javascript:switch_to_login();" class="js-link">
            {% trans "Proceed to Login" %}
        </a>
      </p>
      <!-- SIGNUP -->



  <div class="login_item signup_item">
    <div class="f9 regular dark-grey text-center">{% trans "Alternatively, you can sign up using:" %}</div>
    <a title="{% trans "Login with Facebook" %}" href="{% url 'social:begin' 'facebook' %}" class="social-button facebook"><i class="fa fa-facebook"></i></a>
    <a title="{% trans "Login with Linkedin" %}" href="{% url 'social:begin' 'linkedin' %}" class="social-button linkedin"><i class="fa fa-linkedin"></i></a>
    <a title="{% trans "Login with Google" %}" href="{% url 'social:begin' 'google-oauth2' %}" class="social-button google"><i class="fa fa-google"></i></a>
  </div>

  <div class="full-collum">
    <a id="login_link_signup" href="javascript:switch_to_signup();" class="">
        {% trans "Don't have an account? Sign-Up" %}
    </a>
  </div>

    <!-- PASSWORD RECOVERY -->
    <p class="primary password_recovery_item">
        {% trans "Fill in your email address and you will recieve a link to reset your password." %}
    </p>
    <form id="login_form_email" class="password_recovery_item ajax-submit" method="post" role="form" action="{% url 'site:recover_password' %}">
      <div class="hidden ajax_spinner"></div>
      <fieldset>
        <ul>
          <li>
              <label class="" for="{{ recovery_form.email.id_for_label }}">{{ recovery_form.email.label }}</label>
              {{ recovery_form.email }}
          </li>
        </ul>
      </fieldset>
      <button id="password_recovery_submit" type="submit" class="btn btn-success">{% trans "Recover Password" %}</button>
    </form>
    <p class="primary password_recovery_item">
      <a id="password_recovery_link_login" href="javascript:switch_to_login();" class="js-link">« {% trans "Go Back" %}</a>
    </p>
    <!-- ./PASSWORD RECOVERY -->
</div>

<!-- LOGIN FOOTER -->
<div class="modal-footer login_item f6 grey regular">
    Ao clicar nos botões do facebook ou do linkedin e não for usuário do Wanna Migrate, você será automaticamente cadastrado e estará aceitando os <a class="bold green" href="#">Termos e condições</a> e a <a class="bold green" href="#">Política de privacidade</a> do Wanna Migrate.
</div>
<!-- ./LOGIN FOOTER -->
<!-- SIGNUP FOOTER -->
<div class="modal-footer signup_item">
    Ao cadastrar-se na plataforma você declara estar de acordo com os <a class="bold green" href="#">Termos e condições</a> e a <a class="bold green" href="#">Política de privacidade</a> do Wanna Migrate.
</div>
<!-- ./SIGNUP FOOTER -->
<!-- PASSWORD RECOVERY FOOTER -->
<div class="modal-footer password_recovery_item">
    Ainda com problemas? Entre em contato com o nosso <a class="bold green" href="">suporte.</a>
</div>
<!-- ./PASSWORD RECOVERY FOOTER -->
</div>