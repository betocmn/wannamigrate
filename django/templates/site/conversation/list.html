{% extends "_layouts/main.html" %}
{% load staticfiles %}
{% load i18n %}
{% load string_extras %}

{% block content %}

    <div class="content myaccount">
        <h2 class="title">{% trans 'My Account' %}</h2>
        <div class="interactions">
            {% include "site/_common/my_account_menu.html" with inbox_menu_selected=True %}
            <div style="display: block;" class="inbox">
                <h2 class="title">Inbox</h2>
                {% include "site/conversation/box_menu.html" %}
                <div class="box">
                    <div class="box-top">
                        <div style="display: block; width:auto;" class="newmessage-top">
                            <strong class="newmessage-title">{{ display_title }}</strong>
                        </div>
                        <!--a href="#" class="button bt-newmessage">New message</a-->
                        <ul class="messages-menu">
                            <li><a href="#" id="bt-archive">{% if archive_menu_selected %} {% trans "Restore" %} {% else %} {% trans "Archive" %} {% endif %}</a></li>
                            <li class="check-all"><input id="check-all" class="all" type="checkbox"></li>
                        </ul>
                    </div>
                    <div class="box-messages">
                        <form action="{{ action_url|default:'' }}" method="post" id="main_form">
                            {% csrf_token %}
                            <table>
                                <tbody>
                                {% for entry in entries %}
                                    <tr class="{% if entry.has_updates %}not-read{% else %}read{% endif %}">
                                        <td class="author">
                                            <a href="{% url "site:user_profile" entry.other_user.slug %}" class="message-link">
                                                {{ entry.other_user.name|truncate_smart:15 }} <!--span>(3)</span-->
                                            </a>
                                        </td>
                                        <td class="message-title">
                                            <a href="{% url "site:view_conversation" entry.conversation.id %}" class="message-link">
                                                {{ entry.conversation.subject|truncate_smart:30 }}
                                            </a>
                                        </td>
                                        <td class="date">
                                            {{ entry.conversation.modified_date|date:"b d" }}
                                        </td>
                                        <td class="time">
                                            {{ entry.conversation.modified_date|date:"H:i" }}
                                        </td>
                                        <td class="check">
                                            <span><input type="checkbox" class="archive-check" name="archive" value="{{ entry.id }}"></span>
                                        </td>
                                    </tr>
                                {% empty %}
                                <tr><td>{% trans "(empty)" %}</td></tr>
                                {% endfor %}
                            </tbody></table>
                        </form>
                    </div>


                </div>
            </div>
        </div>
    </div>

{% endblock content %}


{% block scripts %}

    {{ block.super }}

    <!-- JS REQUIRED BY THIS PAGE -->
    <script type="text/javascript" src="{% static 'common/trunk8/js/trunk8.js' %}"></script>

    <!-- INLINE JS -->
    <script type="text/javascript">

        $( document ).ready( function() {
            $( "#bt-archive" ).click(function(e){
                e.preventDefault();
                $( "#main_form" ).submit();
            });
            $( "#check-all" ).change(function(e){
                var v = $( this ).is( ":checked" );
                $('.archive-check').each(function () {
                   $( this ).prop( "checked", v );
                });
            });


        });

    </script>

{% endblock scripts %}