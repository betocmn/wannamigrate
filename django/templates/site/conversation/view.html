{% extends "_layouts/main.html" %}
{% load staticfiles %}
{% load i18n %}
{% load string_extras %}

{% block content %}

    <div class="content myaccount">
        <h2 class="title">{% trans 'My Account' %}</h2>
        <div class="interactions">
            {% include "site/_common/my_account_menu.html" with inbox_menu_selected=True %}
            <div style="display: block;" class="inbox">
                <h2 class="title">Inbox</h2>
                {% include "site/conversation/box_menu.html"%}
                <div class="box">
                    <div class="box-top">
                        <div style="display: block;" class="newmessage-top">
                            <strong class="newmessage-title">{% trans "Conversation" %}</strong>
                        </div>
                    </div>

                    <div style="display: block;" class="box-dialogue">
                        <div class="message-title">
                            <p class="message">{{ conversation.subject }}</p>
                            <a href="#" class="button-transparent bt-answer">Responder</a>
                        </div>
                        <div class="answer">
                            <form action="{{ action_url|default:'' }}" method="post" id="main_form">
                                {% csrf_token %}
                                <fieldset>
                                    <label for="form.content.id_for_label">{% trans "Answer" %}</label>
                                    {{ form.content }}
                                    {{ form.content.errors }}
                                    <input type="submit" class="bt-send button" value="{% trans "Send" %}" />
                                    <a href="#" class="bt-discard" title="Discard">Discard</a>
                                </fieldset>
                            </form>
                        </div>
                        <div class="dialogues">
                            {% for message in messages %}
                                <div class="dialogue {{message.custom_class}}">
                                    <div class="thumb">
                                        {% if message.owner.userpersonal.avatar %}
                                            <img src="{{ message.owner.userpersonal.avatar.thumbnail.url }}" alt="photo" />
                                        {% else %}
                                            <img src="{% static 'site/img/thumb-account.png' %}" alt="photo" />
                                        {% endif %}
                                    </div>
                                    <p class="text">{{message.content|remove_contact_info}}</p>
                                    <strong class="author">{{message.owner.name}}</strong>
                                    <span class="when">{{ message.created_date|date:"d b H:i" }}</span>
                                </div>
                            {% endfor %}
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>

{% endblock content %}


{% block scripts %}

    {{ block.super }}

    <!-- JS REQUIRED BY THIS PAGE -->
    <script type="text/javascript" src="{% static 'common/trunk8/js/trunk8.js' %}"></script>

    <!-- INLINE JS -->
    <script type="text/javascript">

        $( document ).ready( function() {

            {% if form.errors %}
                $('.bt-answer').hide();
                $('.answer').fadeIn('fast')
            {% endif %}

            $('.bt-answer').click(function(event) {
                event.preventDefault()
                $(this).hide();
                $('.answer').fadeIn('fast')
            });

            $('.bt-discard').click(function(event) {
                event.preventDefault()
                $('.answer').fadeOut('fast')
                $('.bt-answer').fadeIn('fast');
            });

        });

    </script>

    {% include "_layouts/analytics.html" %}

{% endblock scripts %}